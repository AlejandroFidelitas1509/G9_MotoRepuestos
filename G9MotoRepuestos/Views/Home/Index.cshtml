@{
    ViewData["Title"] = "Moto Repuestos Rojas - Inicio";

    // LÓGICA AUTOMÁTICA:
    // Si el usuario NO está logueado, esto será 'false' y mostrará el catálogo por defecto.
    bool esPersonalTaller = User.HasClaim(c => c.Type == "Role" && (c.Value == "Admin" || c.Value == "Vendedor"));
}

<div class="container-fluid fade-in pb-5">

    @if (esPersonalTaller)
    {
        <div class="row mb-4">
            <div class="col-12 text-center text-md-start">
                <h2 class="fw-bold text-dark">Panel de Control <span class="text-danger">Rojas</span></h2>
                <p class="text-muted small">Gestión interna para el equipo de Mercedes Norte, Heredia.</p>
            </div>
        </div>

        <div class="row g-3 mb-5">
            <div class="col-12 col-sm-6 col-lg-3">
                <div class="card shadow-sm border-0 h-100 card-hover border-start border-danger border-4">
                    <div class="card-body text-center">
                        <div class="icon-box bg-light-danger mb-3 py-3 rounded"><i class="fas fa-boxes fa-2x text-danger"></i></div>
                        <h6 class="fw-bold">Inventario</h6>
                        <a asp-controller="Inventario" asp-action="Index" class="btn btn-sm btn-danger w-100 shadow-sm">Administrar</a>
                    </div>
                </div>
            </div>
            <div class="col-12 col-sm-6 col-lg-3">
                <div class="card shadow-sm border-0 h-100 card-hover border-start border-success border-4">
                    <div class="card-body text-center">
                        <div class="icon-box bg-light-success mb-3 py-3 rounded"><i class="fas fa-cash-register fa-2x text-success"></i></div>
                        <h6 class="fw-bold">Nueva Venta</h6>
                        <a asp-controller="PuntoVenta" asp-action="Index" class="btn btn-sm btn-success w-100 shadow-sm">Abrir Caja</a>
                    </div>
                </div>
            </div>
            <div class="col-12 col-sm-6 col-lg-3">
                <div class="card shadow-sm border-0 h-100 card-hover border-start border-info border-4">
                    <div class="card-body text-center">
                        <div class="icon-box bg-light-info mb-3 py-3 rounded"><i class="fas fa-motorcycle fa-2x text-info"></i></div>
                        <h6 class="fw-bold">Taller</h6>
                        <a asp-controller="Citas" asp-action="Index" class="btn btn-sm btn-info text-white w-100 shadow-sm">Ver Agenda</a>
                    </div>
                </div>
            </div>
            <div class="col-12 col-sm-6 col-lg-3">
                <div class="card shadow-sm border-0 h-100 card-hover border-start border-warning border-4">
                    <div class="card-body text-center">
                        <div class="icon-box bg-light-warning mb-3 py-3 rounded"><i class="fas fa-file-invoice-dollar fa-2x text-warning"></i></div>
                        <h6 class="fw-bold">Finanzas</h6>
                        <a asp-controller="Contabilidad" asp-action="Index" class="btn btn-sm btn-warning text-white w-100 shadow-sm">Reportes</a>
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="row">
            <div class="col-lg-3 d-none d-lg-block">
                <div class="card border-0 shadow-sm rounded-4 sticky-top" style="top: 90px; z-index: 10;">
                    <div class="card-body p-4">
                        <h5 class="fw-bold mb-4"><i class="fas fa-filter text-danger me-2"></i>Filtrar</h5>
                        <div class="mb-4">
                            <label class="form-label small fw-bold text-uppercase text-muted">Categorías</label>
                            <div class="list-group list-group-flush small">
                                <a href="#" class="list-group-item list-group-item-action border-0 px-0">Motor</a>
                                <a href="#" class="list-group-item list-group-item-action border-0 px-0">Frenos</a>
                                <a href="#" class="list-group-item list-group-item-action border-0 px-0">Aceites</a>
                            </div>
                        </div>
                        <button class="btn btn-danger w-100 rounded-pill py-2 shadow-sm">Aplicar Filtros</button>
                    </div>
                </div>
            </div>

            <div class="col-lg-9">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="fw-bold text-dark mb-0">Nuestros <span class="text-danger">Repuestos</span></h2>
                    <button class="btn btn-dark rounded-pill px-4 shadow-sm position-relative" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasCart">
                        <i class="fas fa-shopping-cart text-danger me-2"></i> Mi Carrito
                    </button>
                </div>

                <div class="row g-4 mt-2">
                    @for (int i = 1; i <= 6; i++)
                    {
                        <div class="col-md-4 col-sm-6">
                            <div class="card h-100 border-0 shadow-sm product-card-client overflow-hidden rounded-4">
                                <div class="bg-light p-4 text-center position-relative">
                                    <i class="fas fa-motorcycle fa-4x text-white opacity-50"></i>
                                    <span class="badge bg-danger position-absolute top-0 start-0 m-3 shadow-sm">Nuevo</span>
                                </div>
                                <div class="card-body">
                                    <h6 class="fw-bold mb-1">Repuesto #@i</h6>
                                    <h5 class="text-danger fw-bold">₡ 15,000</h5>
                                    <button class="btn btn-outline-danger btn-sm w-100 mt-2 rounded-pill">Añadir</button>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    }
</div>

<div class="offcanvas offcanvas-end border-0 shadow-lg rounded-start-4" tabindex="-1" id="offcanvasCart">
    <div class="offcanvas-header bg-dark text-white py-4">
        <h5 class="offcanvas-title fw-bold"><i class="fas fa-shopping-cart text-danger me-2"></i>Su Selección</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body d-flex flex-column">
        <div class="flex-grow-1 overflow-auto">
            <p class="text-muted text-center">Tu carrito está vacío</p>
        </div>
        <div class="border-top pt-3 text-center">
            <h3 class="fw-bolder text-danger mb-4">₡ 0</h3>
            <button class="btn btn-danger btn-lg w-100 py-3 fw-bold rounded-pill shadow-lg">PAGAR</button>
        </div>
    </div>
</div>

<div class="chatbox-wrapper shadow-lg d-none d-md-block" id="chatboxRojas">
    <div class="chatbox-header bg-dark text-white p-2 d-flex justify-content-between align-items-center" onclick="toggleChat()" style="cursor: pointer;">
        <small class="fw-bold text-danger"><i class="fas fa-robot me-2"></i>Asistente Rojas</small>
        <i class="fas fa-minus small" id="chatIcon"></i>
    </div>
    <div id="chatContent">
        <div class="chatbox-body bg-light p-3" style="height: 200px; overflow-y: auto;">
            <div class="chat-msg mb-2 text-center">
                <p class="small bg-white p-2 rounded shadow-sm mb-0">¡Hola Sebas! ¿En qué puedo ayudarte hoy?</p>
            </div>
        </div>
        <div class="chatbox-footer p-2 bg-white border-top">
            <div class="input-group input-group-sm">
                <input type="text" class="form-control" placeholder="Escribe...">
                <button class="btn btn-danger"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>
</div>

<a href="https://wa.me/50672432805" class="whatsapp-float shadow-lg" target="_blank">
    <i class="fab fa-whatsapp"></i>
</a>

@section Scripts {
    <script src="~/js/chatbox.js" asp-append-version="true"></script>
}